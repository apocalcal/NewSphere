# app/prompt_manager.py
from typing import List, Dict, Optional, Tuple

class PromptManager:
    """
    - ë‰´ìŠ¤ ì¹´í…Œê³ ë¦¬ ë¬¸ìì—´ì„ í”„ë¡¬í”„íŠ¸ íƒ€ì…ìœ¼ë¡œ ê·¸ëŒ€ë¡œ ì‚¬ìš©.
    - ë“±ë¡ë˜ì§€ ì•Šì€ íƒ€ì…(ì¹´í…Œê³ ë¦¬)ì´ë©´ DEFAULTë¡œ ì¹˜í™˜.
    - get() : í”„ë¡¬í”„íŠ¸ í…ìŠ¤íŠ¸ë§Œ ë°˜í™˜
    - get_effective(): (ì‹¤ì œ ì‚¬ìš©ëœ íƒ€ì…, í”„ë¡¬í”„íŠ¸ í…ìŠ¤íŠ¸) íŠœí”Œ ë°˜í™˜ â†’ DB ì €ì¥ ì‹œ resolved_typeì„ ê·¸ëŒ€ë¡œ ì“°ë©´ ë¨.
    """

    # â”€â”€ Summarization Config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    LINES = 3  # ê¸°ë³¸ ìš”ì•½ ì¤„ ìˆ˜ (â€» ì¤„ ìˆ˜ í‘œê¸°ëŠ” defaultì—ë§Œ ì ìš©)

    # â”€â”€ Generation Settings â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    TEMPERATURE = 0.2
    # temperature=0.2 ì˜ë¯¸(ìƒ˜í”Œë§ ì˜¨ë„)
    # - ë‚®ì„ìˆ˜ë¡ ë¶„í¬ê°€ ë¾°ì¡± â†’ ê²°ì •ì /ì¼ê´€ì  ì¶œë ¥(ìš”ì•½Â·ì‚¬ì‹¤í˜• ì‘ì—…ì— ì í•©)
    # - ë†’ì„ìˆ˜ë¡ ë¶„í¬ê°€ í‰í‰ â†’ ë‹¤ì–‘/ì°½ì˜(ë¸Œë ˆì¸ìŠ¤í† ë°Â·ì°½ì‘ì— ì í•©)
    # - ìˆ˜ì‹: p = softmax(logits / T). Të¥¼ ì¤„ì´ë©´ ë†’ì€ í™•ë¥  í† í°ì´ ë” ìì£¼ ì„ íƒë©ë‹ˆë‹¤.
    # - Tâ‰ˆ0ì´ë©´ greedyì— ê°€ê¹ê³ , ìƒ˜í”Œë§ì„ ì•ˆ ì“°ë©´(beam/greedy) temperature ì˜í–¥ì´ ê±°ì˜ ì—†ìŠµë‹ˆë‹¤.
    # - top_p/top_kì™€ì˜ ì°¨ì´: temperatureëŠ” ë‚¨ê²¨ë‘” í›„ë³´ â€˜ì‚¬ì´â€™ì˜ í™•ë¥  ê¸°ìš¸ê¸°, top_p/top_këŠ” í›„ë³´ì˜ ë²”ìœ„.
    # - ê¶Œì¥ ë²”ìœ„: ìš”ì•½/ì½”ë“œ 0.1~0.3, ì°½ì‘ 0.7~1.0. ë³¸ ì„¸íŒ…(0.2)ì€ ì‚¬ì‹¤ ìœ„ì£¼ ìš”ì•½ì— ìµœì í™”.

    GEN_PARAMS = {
        "temperature": TEMPERATURE,  # â†“ ë‚®ì„ìˆ˜ë¡ í™•ë¥  ë¶„í¬ê°€ ë¾°ì¡± â†’ ì¼ê´€ì  ê²°ê³¼(ìš”ì•½ì— ì í•©)

        "top_p": 1.0,                # nucleus sampling ìƒí•œ(0~1). 1.0ì´ë©´ ì‚¬ì‹¤ìƒ 'ë„ê¸°'(ì „ì²´ ë¶„í¬ ì‚¬ìš©).
        # 0.8~0.95ë¡œ ë‚®ì¶”ë©´ ìƒìœ„ í† í°ë§Œ ìƒ˜í”Œë§ â†’ ì‚°ë§Œí•¨ ê°ì†Œ, ë³´ìˆ˜ì  ì¶œë ¥.
        # temperatureì™€ top_pë¥¼ ë™ì‹œì— í¬ê²Œ ì¡°ì •í•˜ë©´ ì˜ˆì¸¡ ë¶ˆê°€ì„± â†‘ â†’ ë³´í†µ ë‘˜ ì¤‘ í•˜ë‚˜ë§Œ ì¡°ì •.

        # "max_tokens": 400,         # ìƒì„±(ì¶œë ¥) ê°€ëŠ¥í•œ ìµœëŒ€ í† í° ìˆ˜ ìƒí•œ.
        # ìš”ì•½ ê¸¸ì´ ê´€ë¦¬ìš©. ë„ˆë¬´ ë‚®ìœ¼ë©´ ë¬¸ì¥ ë„ì¤‘ ì ˆë‹¨ë  ìˆ˜ ìˆìŒ.
        # (ëŒ€ëµ 3ì¤„ ìš”ì•½: 120~200 í† í° ì•ˆíŒìœ¼ë¡œ ì‹œì‘í•´ ë³´ë©° ì¡°ì •)

        # "presence_penalty": 0.0,   # ì´ë¯¸ ë“±ì¥í•œ 'ì–´ë–¤' í† í°ì´ë¼ë„ ë‹¤ì‹œ ì“°ëŠ” ê²½í–¥ì„ ì „ë°˜ì ìœ¼ë¡œ ì–µì œ(+ì´ë©´ ì–µì œ).
        # ìƒˆ ì£¼ì œ/ì–´íœ˜ë¡œ í™•ì¥ ìœ ë„. ë²”ìœ„ ë³´í†µ [-2.0, 2.0].
        # ì‚¬ì‹¤ ìš”ì•½ì€ 0.0~0.2 ê¶Œì¥(ë†’ì´ë©´ ì›ë¬¸ ìš©ì–´ ìœ ì§€ê°€ í”ë“¤ë¦´ ìˆ˜ ìˆìŒ).

        # "frequency_penalty": 0.0,  # ê°™ì€ í† í°ì„ 'ë°˜ë³µí•´ì„œ' ì“¸ìˆ˜ë¡ ë” ê°•í•˜ê²Œ íŒ¨ë„í‹°(+ì´ë©´ ì–µì œ).
        # ì¤‘ë³µ ë¬¸êµ¬/ì–´íœ˜ ë°˜ë³µì„ ì¤„ì´ëŠ” ë° ìœ ìš©. ë³´í†µ 0.0~0.3ë¡œ ë¯¸ì„¸ ì¡°ì •.
        # ë„ˆë¬´ ë†’ìœ¼ë©´ í•„ìš”í•œ í•µì‹¬ ìš©ì–´ë„ ê³¼í•˜ê²Œ ë°”ë€” ìˆ˜ ìˆìŒ.
    }

    # 1) í”„ë¡¬í”„íŠ¸ ì„¸íŠ¸
    PROMPTS: Dict[str, Dict[str, str]] = {
        "DEFAULT": {
            "default": "ì´ ê¸°ì‚¬ë¥¼ {lines}ì¤„ë¡œ ìš”ì•½í•´ì¤˜.",
            "p1": "ì‹œê°„ ìˆœì„œëŒ€ë¡œ ì‚¬ê±´ ì „ê°œë¥¼ ì •ë¦¬í•´ {lines}ì¤„ë¡œ ìš”ì•½. í•œ ì¤„=í•µì‹¬ ì‚¬ì‹¤ 1ê°œ. ì¶”ì¸¡Â·ê³¼ì¥ ê¸ˆì§€.",
            "p2": "ì›ë¬¸ êµ¬ì¡°ì™€ í•µì‹¬ ê·¼ê±°ë¥¼ ë‚¨ê¸°ê³  {lines}ì¤„ë¡œ ìš”ì•½. ìˆ«ìÂ·ë‚ ì§œÂ·ê³ ìœ ëª…ì‚¬ëŠ” ì •í™•íˆ ìœ ì§€.",
            "p3": "ìŸì /ë°˜ë¡ ì„ ê· í˜• ìˆê²Œ {lines}ì¤„ë¡œ ìš”ì•½. ì£¼ì¥â†”ê·¼ê±°ë¥¼ ë¶„ë¦¬í•´ ê°„ê²°íˆ.",
            "p4": "ë°°ê²½ì€ ê°„ë‹¨íˆ, ìƒˆë¡œ í™•ì¸ëœ ì‚¬ì‹¤ ì¤‘ì‹¬ìœ¼ë¡œ {lines}ì¤„ ìš”ì•½. ê³¼ë„í•œ í•´ì„ ê¸ˆì§€.",
            "p5": "ì´í•´ê´€ê³„ìë³„ í•œ ì¤„ ì •ë¦¬: ì •ë¶€Â·ê¸°ì—…Â·ì‹œë¯¼/ë‹¨ì²´ ê´€ì ì—ì„œ {lines}ì¤„ ìš”ì•½.",
            "p6": "í›„ ì† ì¼ì •/ì˜í–¥ì„ í¬í•¨í•´ {lines}ì¤„ ìš”ì•½. ì¼ì •Â·ìˆ˜ì¹˜Â·ê¸°ê´€ëª…ì€ ì •í™•íˆ.",
            "p7": "",
            "p8": "",
            "p9": "",
            "p10": "",
        },
        "LUCKY": {
            "default": "ë‰´ìŠ¤ê°€ ì‹œì‘ë˜ê¸° ì „ì— ìµœìƒë‹¨ì— ë¬¸ì ì•ì— 'ğŸ¥ ' ì´ í¬ì¸ˆì¿ í‚¤ ì´ëª¨í‹°ì½˜ì„ ë„£ì–´ ì£¼ì‹œê³ , ì˜¤ëŠ˜ì˜ ìš´ì„¸ë¥¼ ëœë¤ìœ¼ë¡œ ë§Œë“¤ì–´ì„œ ë„£ì–´ ì£¼ì„¸ìš”.",
        },
        "POLITICS": {
            "default": "ì •ì¹˜ ê¸°ì‚¬ {lines}ì¤„ ìš”ì•½: ì •ì±…/ë²•ì•ˆ/ë°œì–¸ì˜ í•µì‹¬ â†’ ì°¬ë°˜ ìŸì Â·ì´í•´ê´€ê³„ì â†’ í–¥í›„ ì¼ì •(í‘œê²°Â·ë°œí‘œÂ·í˜‘ìƒ) ìˆœì„œë¡œ. ìˆ˜ì¹˜Â·ê¸°ê´€ëª…ì€ ì •í™•íˆ ìœ ì§€í•´.",
            "p1": "ìŸì Â·ì…ì¥ ì •ë¦¬í˜• â€” ì •ì¹˜ ê¸°ì‚¬ë¥¼ {lines}ì¤„ë¡œ ìš”ì•½. í•œ ì¤„=í•œ ìŸì : í•µì‹¬, ì…ì¥, ì¼ì •(í‘œê²°Â·ë°œí‘œ ë“±) ìˆœ. ìˆ˜ì¹˜Â·ë‚ ì§œ ìœ ì§€.",
            "p2": "ì •ì±…/ë²•ì•ˆ í¬ë§· â€” â€˜ì •ì±…/ë²•ì•ˆâ€™ ê´€ë ¨ ë³´ë„ë¥¼ {lines}ì¤„ë¡œ ìš”ì•½. â‘  ëª©ì /í•µì‹¬ â‘¡ ëŒ€ìƒ/ìŸì  â‘¢ ì¼ì •Â·ì£¼ì²´. í•œ ì¤„ í•œ ë¬¸ì¥, ìˆ˜ì‹ì–´ ê¸ˆì§€.",
            "p3": "ì •ì±…/ë²•ì•ˆ í¬ë§·(ì„¸ë¶€) â€” â€˜ì •ì±…/ë²•ì•ˆâ€™ ê¸°ì‚¬ë¥¼ {lines}ì¤„ë¡œ ìš”ì•½. 1) ëª©ì /í•µì‹¬ 2) ëŒ€ìƒ/ìŸì  3) ì¼ì •/ì°¸ì—¬ì(í‘œê²°Â·ë°œí‘œ ë“±).",
            "p4": "ë°œì–¸Â·ë…¼ìŸ ë¸Œë¦¬í•‘ â€” ë°œì–¸/ë…¼ìŸ ì¤‘ì‹¬ ì´ìŠˆë¥¼ {lines}ì¤„ë¡œ ìš”ì•½. â‘  ë°œì–¸/ë…¼ìŸ ë‚´ìš© â‘¡ ë°˜ì‘ â‘¢ í–¥í›„ í›„ì†ì¡°ì¹˜.",
            "p5": "ì •ì±…/ê¸°ê´€ë³„ í¬ì»¤ìŠ¤ â€” ì£¼ìš” ë¶€ì²˜/ê¸°ê´€ ì¤‘ì‹¬ìœ¼ë¡œ {lines}ì¤„ ìš”ì•½. ì—­í• Â·ê¶Œí•œÂ·ì¼ì • ìˆœ. ì¶”ì¸¡Â·ë‹¨ì • ê¸ˆì§€.",
            "p6": "ì‹œìœ„/ì •ì¹˜ ì´ë²¤íŠ¸ â€” ì‹œìœ„Â·í–‰ì‚¬Â·ë°œí‘œ ë“± ì¼ì •ì„ {lines}ì¤„ë¡œ ìš”ì•½. ëˆ„êµ¬/ë¬´ì—‡/ì–¸ì œ/ì–´ë””/ì™œ. í•œ ì¤„ í•œ ë¬¸ì¥, ê³¼ì¥ ê¸ˆì§€.",
            "p7": "",
            "p8": "",
            "p9": "",
            "p10": "",
        },
        "ECONOMY": {
            "default": "ê²½ì œ ê¸°ì‚¬ {lines}ì¤„ ìš”ì•½: ì–´ë–¤ ì§€í‘œÂ·ì •ì±…Â·ì´ë²¤íŠ¸ê°€ ë¬´ì—‡ì— ì˜í–¥ì„ ì¤¬ëŠ”ì§€(ìƒí™œë¬¼ê°€Â·í™˜ìœ¨Â·ì£¼íƒÂ·ê¸ˆë¦¬ ë“±)ì™€ ì›ì¸Â·íŒŒê¸‰íš¨ê³¼ë¥¼ ëª…í™•íˆ ì¨ì¤˜.",
            "p1": "ì§€í‘œÂ·ì‹œì¥í˜• â€” â€˜ê²½ì œ ê¸°ì‚¬â€™ë¥¼ {lines}ì¤„ë¡œ ìš”ì•½. í•µì‹¬ ì§€í‘œì™€ ë°©í–¥(â†‘/â†“)Â·ê·¼ê±°Â·ì˜í–¥ì„ ê°„ê²°íˆ. ìˆ˜ì¹˜Â·ë‚ ì§œ ìœ ì§€.",
            "p2": "ì§€í‘œ/ì§€ìˆ˜ â€” ê²½ì œ ê¸°ì‚¬ë¥¼ {lines}ì¤„ë¡œ ìš”ì•½. (ì§€í‘œ/ì§€ìˆ˜) ìˆ˜ì¹˜ì™€ ì „ì›”/ì „ë…„ ëŒ€ë¹„, ì›ì¸, íŒŒê¸‰íš¨ê³¼.",
            "p3": "íˆ¬ìì ê´€ì  â€” â€˜íˆ¬ìì ê´€ì â€™ì—ì„œ {lines}ì¤„ ìš”ì•½. â‘  ê°€ê²©/ê±°ë˜ â‘¡ ë¦¬ìŠ¤í¬Â·ë³€ë™ì„± â‘¢ í–¥í›„ í¬ì¸íŠ¸. ê³¼ì¥/ë‹¨ì • ê¸ˆì§€.",
            "p4": "ê¸°ì—…/ì‹¤ì  ë¸Œë¦¬í•‘ â€” ê¸°ì—…/ì‹¤ì  ë‰´ìŠ¤ë¥¼ {lines}ì¤„ë¡œ ìš”ì•½. ë§¤ì¶œÂ·ì˜ì—…ì´ìµÂ·ì „ë§, ë³€ìˆ˜/ë¦¬ìŠ¤í¬, ì½”ë©˜íŠ¸ í¬í•¨.",
            "p5": "ì •ì±…Â·ì œë„ â€” ê²½ì œ ì •ì±…/ì œë„ ê¸°ì‚¬ë¥¼ {lines}ì¤„ë¡œ ìš”ì•½. â‘  ì·¨ì§€/í•µì‹¬ â‘¡ ëŒ€ìƒ/ì˜í–¥ â‘¢ ì¼ì •/í›„ì†ì¡°ì¹˜.",
            "p6": "ì†Œë¹„/ì²´ê°í˜• â€” ìƒí™œë¬¼ê°€Â·ëŒ€ì¶œÂ·ì„¸ê¸ˆ ë“± ì²´ê° ì´ìŠˆë¥¼ {lines}ì¤„ë¡œ ìš”ì•½. ê¸ˆì•¡Â·ë¹„ìœ¨Â·ê¸°ê°„ ë“± ìˆ˜ì¹˜ ì •í™•íˆ.",
            "p7": "",
            "p8": "",
            "p9": "",
            "p10": "",
        },
        "SOCIETY": {
            "default": "ì‚¬íšŒ ê¸°ì‚¬ {lines}ì¤„ ìš”ì•½: ì‚¬ê±´ ê²½ê³¼(ì–¸ì œ/ì–´ë””ì„œ/ë¬´ì—‡) â†’ í”¼í•´ ê·œëª¨Â·ë‹¹êµ­ ì¡°ì¹˜ â†’ í–¥í›„ ìˆ˜ì‚¬Â·ì œë„ ê°œì„  ë“± í›„ì† ì¡°ì¹˜ë¥¼ ì •ë¦¬í•´ì¤˜.",
            "p1": "ì‚¬ê±´ì‚¬ê³  â€” â€˜ì‚¬ê±´/ì‚¬ê³ â€™ ê¸°ì‚¬ë¥¼ {lines}ì¤„ë¡œ ìš”ì•½. â‘  ì‚¬ê±´ ê²½ê³¼ â‘¡ í”¼í•´/ì›ì¸ â‘¢ ìˆ˜ì‚¬/ì¡°ì¹˜.",
            "p2": "ì¬ë‚œ/ì•ˆì „ â€” ì¬ë‚œ/ì•ˆì „ ì´ìŠˆë¥¼ {lines}ì¤„ë¡œ ìš”ì•½. ë°œìƒ ì›ì¸, ëŒ€ì‘ í˜„í™©, ì¶”ê°€ ìœ„í—˜/ì˜ˆë°©.",
            "p3": "ì‚¬íšŒ ì´ìŠˆ â€” ìŸì /ê°ˆë“±í˜• ì´ìŠˆë¥¼ {lines}ì¤„ë¡œ ìš”ì•½. ìŸì , ì´í•´ê´€ê³„ì ì…ì¥, ë²•/ì œë„Â·í›„ì† ê³¼ì œ.",
            "p4": "ì§€ì—­/ìƒí™œ â€” ì§€ì—­ì‚¬íšŒÂ·ìƒí™œ ë°€ì°© ì£¼ì œë¥¼ {lines}ì¤„ë¡œ ìš”ì•½. ì˜í–¥ ëŒ€ìƒ, ë³€í™” í¬ì¸íŠ¸, ìœ ì˜ì‚¬í•­.",
            "p5": "ì‚¬ë²•/í–‰ì • â€” íŒê²°/ìˆ˜ì‚¬/í–‰ì •ì²˜ë¶„ì„ {lines}ì¤„ë¡œ ìš”ì•½. ê²°ì • ìš”ì§€, ê·¼ê±°, íŒŒì¥/í›„ì†.",
            "p6": "ë…¸ë™/ë³µì§€ â€” ë…¸ë™Â·ë³µì§€ ì´ìŠˆë¥¼ {lines}ì¤„ë¡œ ìš”ì•½. ì œë„ ë³€í™”, ëŒ€ìƒ/ì¡°ê±´, ìœ ì˜ì /ì‚¬ë¡€.",
            "p7": "",
            "p8": "",
            "p9": "",
            "p10": "",
        },
        "LIFE": {
            "default": "ìƒí™œ/ë¬¸í™” {lines}ì¤„ ìš”ì•½: íŠ¸ë Œë“œÂ·ì œë„ ë³€í™”ì˜ í•µì‹¬ â†’ ì´ìš©ìì—ê²Œ ë¯¸ì¹˜ëŠ” ì˜í–¥ê³¼ ìœ ì˜ì  â†’ ê´€ë ¨ ì¼ì •Â·ê°€ê²©Â·ì´ìš© ë°©ë²•ì„ ì •ë¦¬í•´ì¤˜.",
            "p1": "íŠ¸ë Œë“œ/ê°€ì´ë“œ â€” íŠ¸ë Œë“œ ê¸°ì‚¬ë¥¼ {lines}ì¤„ë¡œ ìš”ì•½. ìœ í–‰ ê·¼ê±°(ì§€í‘œ/ì‚¬ë¡€) â†’ ì†Œë¹„ì/ì´ìš©ì ì˜í–¥ â†’ í•œ ì¤„ í•œ ë¬¸ì¥ ê°€ì´ë“œ.",
            "p2": "ìƒí™œ/ì§€ì› â€” ìƒí™œì§€ì›/ë³µì§€/ì§€ì¹¨ ë‰´ìŠ¤ë¥¼ {lines}ì¤„ë¡œ ìš”ì•½. ëŒ€ìƒ/ì¡°ê±´, ì‹ ì²­ ë°©ë²•, ì¼ì •/ì£¼ì˜.",
            "p3": "ì†Œë¹„/ì§€ì¶œ â€” ì†Œë¹„ ê´€ë ¨ ì†Œì‹ì„ {lines}ì¤„ë¡œ ìš”ì•½. ê°€ê²©/ì¡°ê±´, ë¹„êµ í¬ì¸íŠ¸, ì‹¤ìš© ì •ë³´.",
            "p4": "ë¬¸í™”/êµìœ¡ â€” ë¬¸í™”Â·êµìœ¡ ê´€ë ¨ ê¸°ì‚¬ë¥¼ {lines}ì¤„ë¡œ ìš”ì•½. ë‚´ìš©/ëŒ€ìƒ, ì¼ì •/ì ‘ìˆ˜, í˜œíƒ/ìœ ì˜ì .",
            "p5": "ê±´ê°•/ì•ˆì „ â€” ê±´ê°•/ì•ˆì „ ì´ìŠˆë¥¼ {lines}ì¤„ë¡œ ìš”ì•½. ì£¼ìš” ë‚´ìš©, ê¶Œê³ /ì œí•œ, ì£¼ì˜ì .",
            "p6": "ìƒí™œ íŒ â€” ìƒí™œ íŒì„ {lines}ì¤„ë¡œ ìš”ì•½. ìƒí™©/ëŒ€ìƒ, í•µì‹¬ ìš”ë ¹, ì°¸ê³  ë§í¬/ê¸°ê´€(ìˆìœ¼ë©´).",
            "p7": "",
            "p8": "",
            "p9": "",
            "p10": "",
        },
        "INTERNATIONAL": {
            "default": "ì„¸ê³„ ë‰´ìŠ¤ {lines}ì¤„ ìš”ì•½: êµ­ê°€Â·ê¸°ê´€Â·í•©ì˜ì˜ í•µì‹¬ ë‚´ìš© â†’ ë°°ê²½ê³¼ ì´í•´ê´€ê³„ â†’ ì œì¬Â·í˜‘ìƒÂ·êµ°ì‚¬Â·ê²½ì œì  íŒŒê¸‰íš¨ê³¼ë¥¼ ê°„ë‹¨íˆ ì •ë¦¬í•´ì¤˜.",
            "p1": "ì •ìƒíšŒë‹´/ì™¸êµ â€” â€˜êµ­ì œ/ì™¸êµ ë‰´ìŠ¤â€™ë¥¼ {lines}ì¤„ë¡œ ìš”ì•½. í•©ì˜/ë°œí‘œ ìš”ì§€, ì¼ì •/ì°¸ì—¬ì, íŒŒì¥(ì§€ì—­/ì‚°ì—…).",
            "p2": "ë¶„ìŸ/ì œì¬ â€” ë¶„ìŸ/ì œì¬ ì´ìŠˆë¥¼ {lines}ì¤„ë¡œ ìš”ì•½. ì¡°ì¹˜ ë‚´ìš©, ë‹¹ì‚¬ì/ëŒ€ìƒ, íŒŒì¥Â·ì¶”ê°€ ë³€ìˆ˜.",
            "p3": "êµ­ì œì§€í‘œ/ê²½ì œ â€” ê¸€ë¡œë²Œ ì§€í‘œ/ë°œí‘œë¥¼ {lines}ì¤„ë¡œ ìš”ì•½. ìˆ˜ì¹˜/ë³€í™”, í•´ì„/ì˜í–¥, í›„ì† ì¼ì •.",
            "p4": "ë™ë§¹/ì—°í•© â€” ë™ë§¹/ì—°í•©/í˜‘ë ¥ ë‰´ìŠ¤ë¥¼ {lines}ì¤„ë¡œ ìš”ì•½. ëª©ì Â·ë²”ìœ„, ì´í•´ê´€ê³„, ì „ë§.",
            "p5": "ì¸ê¶Œ/ë‚œë¯¼ â€” ì¸ê¶Œ/ë‚œë¯¼ ì´ìŠˆë¥¼ {lines}ì¤„ë¡œ ìš”ì•½. ì‚¬ê±´ ìš”ì§€, ëŒ€ì‘/ë¹„íŒ, êµ­ì œ ê·œë²”/í›„ì†.",
            "p6": "êµ­ë‚´ ì˜í–¥ â€” í•´ì™¸ ì´ìŠˆì˜ êµ­ë‚´ ì˜í–¥(ì‚°ì—…/ì •ì±…/ì‹œì¥)ì„ {lines}ì¤„ë¡œ ìš”ì•½.",
            "p7": "",
            "p8": "",
            "p9": "",
            "p10": "",
        },
        "IT_SCIENCE": {
            "default": "IT/ê³¼í•™ {lines}ì¤„ ìš”ì•½: ê¸°ìˆ /ì—°êµ¬ì˜ ëª©ì Â·ì›ë¦¬Â·ì„±ê³¼ â†’ ì„±ëŠ¥(ì •í™•ë„/ì†ë„ ë“±) â†’ ì‹¤ì œ ì ìš© ë¶„ì•¼Â·í–¥í›„ ë¡œë“œë§µì„ í¬í•¨í•´ì¤˜.",
            "p1": "AI/ê¸°ìˆ  ë¸Œë¦¬í•‘ â€” â€˜AI/ê¸°ìˆ â€™ ê¸°ì‚¬ë¥¼ {lines}ì¤„ë¡œ ìš”ì•½. í•µì‹¬ ì›ë¦¬/ê°œì„ ì , ì„±ëŠ¥ì§€í‘œ/ë¹„êµ, ì ìš© ì‚¬ë¡€.",
            "p2": "ì œí’ˆ/ì„œë¹„ìŠ¤ ì¶œì‹œ â€” â€˜ì‹ ì œí’ˆ/ì„œë¹„ìŠ¤â€™ ë‰´ìŠ¤ë¥¼ {lines}ì¤„ë¡œ ìš”ì•½. í•µì‹¬ ê¸°ëŠ¥, ê°€ê²©/ì •ì±…, ê²½ìŸÂ·ì°¨ë³„ì .",
            "p3": "ì—°êµ¬ ê²°ê³¼ â€” ì—°êµ¬ ê²°ê³¼ë¥¼ {lines}ì¤„ë¡œ ìš”ì•½. ë°©ë²•/ë°ì´í„°, ì£¼ìš” ìˆ˜ì¹˜, í•œê³„/ì¬í˜„ ê°€ëŠ¥ì„±/ë‹¤ìŒ ë‹¨ê³„.",
            "p4": "ë³´ì•ˆ/ì•ˆì „ â€” ë³´ì•ˆ/ì•ˆì „ ì´ìŠˆë¥¼ {lines}ì¤„ë¡œ ìš”ì•½. ì·¨ì•½ì /ì‚¬ê³ , ì˜í–¥ ë²”ìœ„, ëŒ€ì‘/íŒ¨ì¹˜.",
            "p5": "ì •ì±…/ê·œì œ â€” IT ê·œì œ/í‘œì¤€ì„ {lines}ì¤„ë¡œ ìš”ì•½. ì·¨ì§€/ëŒ€ìƒ, ì˜ë¬´/ì™„í™”, ì¼ì •/ìœ ì˜ˆ.",
            "p6": "ì‚°ì—…/ì‹œì¥ â€” ì‚°ì—…/ì‹œì¥ ë™í–¥ì„ {lines}ì¤„ë¡œ ìš”ì•½. ìˆ˜ìš”/ê³µê¸‰, ì£¼ìš” ì—…ì²´, ì „ë§/ë¦¬ìŠ¤í¬.",
            "p7": "",
            "p8": "",
            "p9": "",
            "p10": "",
        },
        "VEHICLE": {
            "default": "ìë™ì°¨/êµí†µ {lines}ì¤„ ìš”ì•½: ëª¨ë¸/ê°€ê²©/ì¸í”„ë¼ í•µì‹¬ â†’ ì„±ëŠ¥Â·ì•ˆì „Â·ì£¼í–‰ê±°ë¦¬ ë“± ìˆ˜ì¹˜ â†’ ë³´ì¡°ê¸ˆÂ·ì •ì±…Â·ì‚¬ê³ Â·êµí†µì •ì±… ì˜í–¥ ìˆœì„œë¡œ.",
            "p1": "ì°¨ëŸ‰/ëª¨ë¸ â€” ì‹ ì°¨/ëª¨ë¸ ë‰´ìŠ¤ë¥¼ {lines}ì¤„ë¡œ ìš”ì•½. íŒŒì›ŒíŠ¸ë ˆì¸/ì„±ëŠ¥, ê°€ê²©/íŠ¸ë¦¼, ë¹„êµ í¬ì¸íŠ¸.",
            "p2": "ì¶©ì „ ì¸í”„ë¼/ì •ì±… â€” â€˜ì¶©ì „/ì¸í”„ë¼/ì •ì±…â€™ ê¸°ì‚¬ë¥¼ {lines}ì¤„ë¡œ ìš”ì•½. ë³€í™” ìš”ì§€, ìš”ê¸ˆ/ì§€ì›, ì´ìš©ì ì˜í–¥.",
            "p3": "ëª¨ë¹Œë¦¬í‹°/êµí†µ â€” êµí†µÂ·ëª¨ë¹Œë¦¬í‹° ì´ìŠˆë¥¼ {lines}ì¤„ë¡œ ìš”ì•½. ì •ì±…/ì œë„, ì•ˆì „/ì‚¬ê³ , ì´ìš©ì ìœ ì˜ì .",
            "p4": "ë¦¬ì½œ/ì•ˆì „ â€” ë¦¬ì½œ/ì•ˆì „ ê´€ë ¨ ë‰´ìŠ¤ë¥¼ {lines}ì¤„ë¡œ ìš”ì•½. ëŒ€ìƒ/ì›ì¸, ì¡°ì¹˜ ë‚´ìš©, ì¼ì •/ë°©ë²•.",
            "p5": "ììœ¨ì£¼í–‰/SW â€” ììœ¨ì£¼í–‰/ì†Œí”„íŠ¸ì›¨ì–´ ì´ìŠˆë¥¼ {lines}ì¤„ë¡œ ìš”ì•½. ê¸°ëŠ¥/ì œì•½, ê·œì œ/ìœ¤ë¦¬, ë¡œë“œë§µ.",
            "p6": "ì¤‘ê³ /ì •ë¹„ â€” ì¤‘ê³ /ì •ë¹„ ê´€ë ¨ ì†Œì‹ì„ {lines}ì¤„ë¡œ ìš”ì•½. ê°€ê²©/ë³´ì¦, ì ê²€ í¬ì¸íŠ¸, ì†Œë¹„ì ì£¼ì˜.",
            "p7": "",
            "p8": "",
            "p9": "",
            "p10": "",
        },
        "TRAVEL_FOOD": {
            "default": "ì—¬í–‰/ìŒì‹ {lines}ì¤„ ìš”ì•½: ì¥ì†Œ/ì½”ìŠ¤/ë©”ë‰´ì˜ íŠ¹ì§• â†’ ê°€ê²©Â·ìš´ì˜ì‹œê°Â·ì˜ˆì•½Â·ì ‘ê·¼ ë“± ì‹¤ìš© ì •ë³´ â†’ ì£¼ì˜ì‚¬í•­Â·ì„±ìˆ˜ê¸° íŒì„ ì •ë¦¬í•´ì¤˜.",
            "p1": "ì—¬í–‰ ì½”ìŠ¤ â€” â€˜ì—¬í–‰ ê¸°ì‚¬â€™ë¥¼ {lines}ì¤„ë¡œ ìš”ì•½. ëª©ì ì§€/ê¸°ê°„/ë¹„ìš©, ì´ë™/ìˆ™ë°•/ì¶”ì²œ í¬ì¸íŠ¸.",
            "p2": "í•­ê³µ/í˜¸í…” â€” í•­ê³µ/í˜¸í…” ê´€ë ¨ ì†Œì‹ì„ {lines}ì¤„ë¡œ ìš”ì•½. ê°€ê²©/ì¡°ê±´, ì˜ˆì•½Â·ì·¨ì†Œ ê·œì •, ì£¼ì˜/ì¶”ì²œ.",
            "p3": "í‘¸ë“œ/ì™¸ì‹ â€” â€˜í‘¸ë“œ/ì™¸ì‹ ë‰´ìŠ¤â€™ë¥¼ {lines}ì¤„ë¡œ ìš”ì•½. ë©”ë‰´/ê°€ê²©/ì •ë³´, í–‰ì‚¬/íŠ¹ê°€, ì§€ì—­/ê°€ì´ë“œ.",
            "p4": "ì¶•ì œ/í–‰ì‚¬ â€” â€˜í˜ìŠ¤í‹°ë²Œ/í–‰ì‚¬â€™ë¥¼ {lines}ì¤„ë¡œ ìš”ì•½. ë¼ì¸ì—…/í”„ë¡œê·¸ë¨, ì¼ì •/ì¥ì†Œ/í‹°ì¼“, ê´€ëŒ í¬ì¸íŠ¸.",
            "p5": "ì§€ì—­/ê´€ê´‘ â€” ì§€ì—­ ê´€ê´‘ ì†Œì‹ì„ {lines}ì¤„ë¡œ ìš”ì•½. ì½”ìŠ¤/êµí†µ, ë¹„ìš©/íŒ¨ìŠ¤, ì„±ìˆ˜ê¸° íŒ.",
            "p6": "ì£¼ì˜/ì•ˆì „ â€” ì—¬í–‰/ì™¸ì‹ ìœ ì˜ì‚¬í•­ì„ {lines}ì¤„ë¡œ ìš”ì•½. ì˜ˆì•½/ìœ„ìƒ/ì•ˆì „ ì²´í¬ë¦¬ìŠ¤íŠ¸.",
            "p7": "",
            "p8": "",
            "p9": "",
            "p10": "",
        },
        "ART": {
            "default": "ì˜ˆìˆ  {lines}ì¤„ ìš”ì•½: ì‘í’ˆÂ·ì „ì‹œÂ·ê³µì—°ì˜ ì£¼ì œì™€ ì˜ì˜ â†’ ì‘ê°€/ê¸°ê´€ ì •ë³´ì™€ í‰íŒÂ·ìˆ˜ìƒ â†’ ê´€ë ¨ ì •ë³´(ê¸°ê°„Â·ì¥ì†ŒÂ·ìš”ê¸ˆ)ë¥¼ ê°„ê²°íˆ ì¨ì¤˜.",
            "p1": "ì „ì‹œ/ê³µì—° ì•ˆë‚´í˜• â€” â€˜ì˜ˆìˆ  ê¸°ì‚¬â€™ë¥¼ {lines}ì¤„ë¡œ ìš”ì•½. ì‘í’ˆ/ì „ì‹œ/ê³µì—° í•µì‹¬, ì¥ì†Œ/ê¸°ê°„/í‹°ì¼“, íŠ¹ì§•/í…Œë§ˆ.",
            "p2": "í‰ë¡ /ìˆ˜ìƒ ë¸Œë¦¬í•‘ â€” â€˜í‰ë¡ /ìˆ˜ìƒ ì†Œì‹â€™ì„ {lines}ì¤„ë¡œ ìš”ì•½. ì‘í’ˆ/ìˆ˜ìƒ ë‚´ì—­, ì˜ë¯¸/í‰ê°€, íŒŒì¥/ë…¼ì  ìµœì†Œí™”.",
            "p3": "í˜ìŠ¤í‹°ë²Œ/í–‰ì‚¬ ê°€ì´ë“œ â€” â€˜í˜ìŠ¤í‹°ë²Œ/í–‰ì‚¬â€™ë¥¼ {lines}ì¤„ë¡œ ìš”ì•½. ë¼ì¸ì—…/í”„ë¡œê·¸ë¨, ì¼ì •/ì¥ì†Œ/í‹°ì¼“, ê´€ëŒ í¬ì¸íŠ¸.",
            "p4": "ì‘ê°€/ê¸°ê´€ â€” ì‘ê°€Â·ê¸°ê´€ ê´€ë ¨ ë‰´ìŠ¤ë¥¼ {lines}ì¤„ë¡œ ìš”ì•½. ì´ë ¥/ì—…ì , ëŒ€í‘œì‘, ì „ì‹œ/ê³µì—°/ì‹ ì‘.",
            "p5": "ì‚°ì—…/ì‹œì¥ â€” ì˜ˆìˆ  ì‚°ì—…/ì‹œì¥ ì†Œì‹ì„ {lines}ì¤„ë¡œ ìš”ì•½. ê±°ë˜/ê²½ë§¤, ì •ì±…/ì§€ì›, íŠ¸ë Œë“œ.",
            "p6": "ì£¼ì˜/ì•ˆë‚´ â€” ê´€ëŒ/ì°¸ì—¬ ìœ ì˜ì‚¬í•­ì„ {lines}ì¤„ë¡œ ìš”ì•½. ì˜ˆì•½/ì´ìš©/í™˜ë¶ˆ ê·œì •, ì ‘ê·¼ì„± ì •ë³´.",
            "p7": "",
            "p8": "",
            "p9": "",
            "p10": "",
        },
    }

    # ê¸°ë³¸ íƒ€ì…
    DEFAULT_TYPE = "DEFAULT"

    # 2) ë³„ì¹­/ì •ê·œí™” í…Œì´ë¸” (ì¹´í…Œê³ ë¦¬ â†’ íƒ€ì…)
    #   - ë‰´ìŠ¤ ì¹´í…Œê³ ë¦¬ì˜ ë‹¤ì–‘í•œ í‘œê¸°ë¥¼ ë³´ì •
    #   - ë ˆê±°ì‹œ('AIBOT')ê°€ ì˜¤ë©´ DEFAULTë¡œ í¡ìˆ˜
    TYPE_ALIASES: Dict[str, str] = {
        "": "DEFAULT",
        "AIBOT": "DEFAULT",

        # ì¹´í…Œê³ ë¦¬ í‘œê¸° ë³´ì •(ì„ íƒ)
        "WORLD": "INTERNATIONAL",
        "GLOBAL": "INTERNATIONAL",
        "IT": "IT_SCIENCE",
        "SCIENCE": "IT_SCIENCE",
        "AUTO": "VEHICLE",
        "CAR": "VEHICLE",
        "TRAVEL": "TRAVEL_FOOD",
        "FOOD": "TRAVEL_FOOD",
        "CULTURE": "ART",
    }

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ë‚´ë¶€ ìœ í‹¸
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    @staticmethod
    def _normalize_key(s: Optional[str]) -> str:
        u = (s or "").upper().strip()
        return u.replace("-", "_").replace(" ", "_").replace("/", "_")

    @classmethod
    def _canon_type(cls, t: Optional[str]) -> str:
        """
        ë¯¸ì§€ì •/ë¯¸ë“±ë¡ íƒ€ì…ì„ DEFAULTë¡œ ì •ê·œí™”.
        """
        u = cls._normalize_key(t)
        u = cls.TYPE_ALIASES.get(u, u or cls.DEFAULT_TYPE)
        return u if u in cls.PROMPTS else cls.DEFAULT_TYPE

    @staticmethod
    def _fmt(s: str, base: Dict) -> str:
        try:
            return s.format(**base)
        except KeyError:
            # ì•Œ ìˆ˜ ì—†ëŠ” placeholderëŠ” ê·¸ëŒ€ë¡œ ë‘ 
            return s

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # ê³µê°œ API
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    @classmethod
    def get_many_by_types(
            cls,
            types: List[str],
            include_default: bool = True,
            **params
    ) -> List[Dict[str, str]]:
        """
        ì—¬ëŸ¬ íƒ€ì…ì„ ë°›ì•„ ê° íƒ€ì…ì— ë“±ë¡ëœ ëª¨ë“  í”„ë¡¬í”„íŠ¸ë¥¼ ë°˜í™˜.
        íƒ€ì…ì´ ë¯¸ì§€ì •/ë¯¸ë“±ë¡ì´ë©´ DEFAULTë¡œ ë§¤í•‘.
        ë°˜í™˜: [{"id": "TYPE:key", "prompt": "..."}, ...]
        """
        results: List[Dict[str, str]] = []
        seen = set()
        base = {"lines": 3, **params}

        for t in (types or [cls.DEFAULT_TYPE]):
            g = cls._canon_type(t)
            entries = cls.PROMPTS.get(g, {})
            for k, v in entries.items():
                if k == "default" and not include_default:
                    continue
                pid = f"{g}:{k}"
                if pid in seen:
                    continue
                seen.add(pid)
                results.append({"id": pid, "prompt": cls._fmt(v, base)})
        return results

    @classmethod
    def get(cls, prompt_or_id: Optional[str], type_: Optional[str], **params) -> str:
        """
        í”„ë¡¬í”„íŠ¸ í…ìŠ¤íŠ¸ë§Œ ë°˜í™˜.
        - type_ì´ ë¯¸ì§€ì •/ë¯¸ë“±ë¡ì´ë©´ DEFAULTë¡œ ì²˜ë¦¬
        - prompt_or_idê°€ ì—†ìœ¼ë©´ í•´ë‹¹ íƒ€ì…ì˜ default ì‚¬ìš©
        - "TYPE:key" í‘œê¸° ì§€ì›, í‚¤ê°€ ì—†ìœ¼ë©´ DEFAULTë¡œ í´ë°±
        - ì»¤ìŠ¤í…€ ë¬¸ìì—´ì´ë©´ ê·¸ëŒ€ë¡œ ì‚¬ìš©
        """
        base = {"lines": 3, **params}
        t = cls._canon_type(type_)
        s = (prompt_or_id or "").strip()

        if not s:
            return cls._fmt(cls.PROMPTS[t].get("default", cls.PROMPTS[cls.DEFAULT_TYPE]["default"]), base)

        # "TYPE:key"
        if ":" in s:
            tt, key = s.split(":", 1)
            tt = cls._canon_type(tt)
            val = cls.PROMPTS.get(tt, {}).get(key)
            if val:
                return cls._fmt(val, base)
            # DEFAULTì—ì„œ ê°™ì€ key ì¬ì‹œë„
            val = cls.PROMPTS[cls.DEFAULT_TYPE].get(key)
            if val:
                return cls._fmt(val, base)
            # ê·¸ë˜ë„ ì—†ìœ¼ë©´ DEFAULT.default
            return cls._fmt(cls.PROMPTS[cls.DEFAULT_TYPE]["default"], base)

        # í˜„ì¬ íƒ€ì…ì—ì„œ í‚¤ ì¡°íšŒ
        val = cls.PROMPTS.get(t, {}).get(s)
        if val:
            return cls._fmt(val, base)

        # DEFAULTì—ì„œ í‚¤ ì¡°íšŒ
        val = cls.PROMPTS[cls.DEFAULT_TYPE].get(s)
        if val:
            return cls._fmt(val, base)

        # ì»¤ìŠ¤í…€ ë¬¸ìì—´
        return cls._fmt(s, base)

    @classmethod
    def get_effective(
            cls,
            prompt_or_id: Optional[str],
            type_candidate: Optional[str],
            **params
    ) -> Tuple[str, str]:
        """
        (resolved_type, prompt_text) ë°˜í™˜.
        - type_candidateê°€ PROMPTSì— ì—†ìœ¼ë©´ DEFAULTë¡œ ì¹˜í™˜
        - prompt_or_idê°€ ì—†ìœ¼ë©´ resolved_typeì˜ default ì‚¬ìš©
        - "TYPE:key" ì§€ì› ë° DEFAULT í´ë°±
        """
        resolved_type = cls._canon_type(type_candidate)
        text = cls.get(prompt_or_id, resolved_type, **params)
        # ì£¼ì˜: get() ë‚´ë¶€ì—ì„œë„ resolved_typeì´ ë°”ë€Œì§„ ì•Šê²Œ ì„¤ê³„ (TYPE:keyì˜ TYPEì€ ë³„ê°œ)
        return resolved_type, text
